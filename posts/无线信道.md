> 部分偷自iot-book:https://iot-book.github.io/

# 无线信道

## 信道定义

就像车辆运输需要道路一样，信号的传输也需要通过信道。根据维基百科的定义，信道又称为通道、频道或者波道，是信号在通信系统中传输的通道，由信号从发射端到接收端所经过的所有传输媒质所构成，广义的信道定义还包括传输信号的相关设备。理解信道是理解数据传输的重要基础，在物联网领域的前沿研究工作——从物联网通信到物联网感知——都是以通信信道为基础的，他们或要解决信道带来的问题，或利用信道带来的特点。

在学习这一部分的过程中，我们始终要围绕着下面的问题：

- 什么是信道？
- 怎样表示信道?

首先我们知道传输目的，本质上来说就是基于接收到的信号计算出发送的信号。而在这个过程中，我们首先要搞清楚如何表示信号（调制）以及如何表示信道（传输的影响）。假设发送信号为s, 那么接收到到的信号为f(s),其中函数f就是信道对信号的影响，传输的目的就是基于接收到的f(s)计算出s。当然最理想的情况下，信道不会对信号产生任何影响，那么接收到的f(s)=s。

通俗地来理解信道，一个信号从发送端通过一定的媒介到达接收端。这就是一个典型通信过程，就包括发射端-信道-接收端三个部分。例如你晚上写的作业，第二天交到老师的手上，你就是发送端，作业就是你的数据，作业本以及交的这个过程就是信道，老师就是接收方。 所以要保证老师看到你的作业，首先你写的内容至少要保证没有问题，你会想尽办法保证写的东西是正确的，怕老师看不清会把字写大一些，为了让老师知道是谁的作业会把名字写上，作业里面的重点会标记好，这些都是传输端做的保证发送稳定性的方法。同时你也会尽量保证作业本能够稳定的交到老师手上，这是减少信道的影响，下雨了你会将作业小心的保护起来等，老师收到作业知道才知道你写的内容。确保老师看到作业的时候，知道你当时写了什么内容。

信道可以分为狭义信道和广义信道两类：

**狭义信道：** 按照传输媒质来划分，可以分为有线信道、无线信道和存储信道三类。值得注意的是，磁带、磁盘等数据存储媒质也可以被看作是一种通信信道。将数据写入存储媒质的过程即等效于发射机将信号传输到信道的过程，将数据从存储媒质读出的过程即等效于接收机从信道接收信号的过程。

**广义信道：** 按照信道功能进行划分，可以分为调制信道和编码信道两类。调制信道是指信号从调制器的输出端传输到解调器的输入端经过的部分。对于调制和解调的研究者来说，信号在调制信道上经过的传输媒质和变换设备都对信号做出了某种形式的变换，研究者只关心这些变换的输入和输出的关系，并不关心实现这一系列变换的具体物理过程。这一系列变换的输入与输出之间的关系。编码信道是指数字信号由编码器输出端传输到译码器输入端经过的部分。对于编译码的研究者来说，编码器输出的数字序列经过编码信道上的一系列变换之后，在译码器的输入端成为另一组数字序列，研究者只关心这两组数字序列之间的变换关系，而并不关心这一系列变换发生的具体物理过程，甚至并不关心信号在调制信道上的具体变化。



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/CH3_%E4%BF%A1%E9%81%93.png)







图. 信道示意





理解信道是理解通信的基础，也是理解物联网通信和感知的重要基础。因为很多通信处理和感知方法都要处理或者利用信道的影响，理解信道的过程首先需要理解信道对信号的基本影响（如衰减、多径效应等），以及这些影响如何来科学的进行表示。这就是这章要讲的全部，理解这些之后，对于通信过程中碰到的大部分问题其实就比较明确和容易理解了，之前我们说过信道的理解也是物联网感知的基础，理解了信道后对于理解物联网无线定位和感知也比较方便了。

## 信道冲击响应（CIR）

信道研究的第一步，是要建立对信道的描述，即表示出任意输入信号通过该信道后的响应信号。但可能的输入信号波形有成千上万种，针对某个特定信道，我们不可能在该信道上对每一种波形的响应都进行研究，因此我们必须要找到那个可以用于构造任意波形的“单位1”。

幸运的是，在信道描述方面，单位脉冲信号就是一种非常理想的“单位1”：我们可以将任意信号可以分解成若干不同时延的单位脉冲信号的线性叠加。这样一来，通过研究单位脉冲通过信道后的响应，我们可以计算出任意信号通过信道后的结果。例如，假设发送端不是单位冲击信号，而是两倍高度的冲击信号，那么很自然的接收方的信号也会变成了两倍高度。当然这里我们假设信号是线性的，非线性的信道我们暂时不考虑，在大部分的分析中，线性信道的假设是足够且合理的了，本材料后面的部分也都是基于线性信道进行介绍的。注意大家看到的大部分论文等也都基于线性信道，所以后面材料中除非特别说明，都是假设线性信道。

我们用一个例子来说明如何用单位脉冲信号的信道响应（CIR， Channel Impulse Response）来表示任意信号通过信道后的响应输出。为例方便表示，以下说明将使用离散信号形式。离散形式的单位脉冲信号可以表示为：

> CIR这个词大家在阅读论文的时候很常见，它的计算方法是这样来的。

δ[n]={1,0,n=0n≠0

即只在0时刻输出为“1”，其他时刻输出为“0”。通过采样，任意信号可以表示为离散形式，如下图所示。



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/Channel1.png)







图. 通过采样，任意信号可以表示为若干单位脉冲信号的组合





每一个信号采样点可以看作一个具有特定时延和幅度缩放的单位冲击信号。例如在时刻1幅度为0.9的采样点，可以表示为0.9δ[n−1]。类似的，我们可以将整段信号所有N个采样点表示为N个单位脉冲的和，即：

s[n]=∑k=0N−1Ampl[k]×δ[n−k]

对于线性信道，如果我们知道单位脉冲信号δ[n]通过该信道后的响应δ′[n]，则我们可以直接计算得到任意信号s[n]通过该信道后的响应信号：

s′[n]=∑k=0N−1Ampl[k]×δ′[n−k]

接下来，我们回到信道冲击响应（CIR），探究单位脉冲信号通过信道后通常会发生怎样的变化。信道对单位脉冲信号的影响通常体现在两方面：一是由于路径损耗和阴影衰落造成脉冲信号的能量发生衰减；二是由于信道中存在多个传播路径导致在接收端先后收到多个不同脉冲信号副本的叠加。



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/Channel2.png)







图. 信道响应示意：图中箭头代表了单位冲击信号经过信道后产生了不同的延迟和衰减的信号副本。





上图直观地展示了信道对单位冲击信号的影响：一个单位冲击信号在通过信道到达接收端的过程中，由于可能经过不同的传播路径，因此在接收端将产生不同传播时延的信号副本。这些时延副本分别具有不同的信号衰减和频率相位变化。在接收端看来，收到的信号（信道冲击响应）就是这些不同延迟的信号副本的叠加。



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/Channel3.png)







图. 不同时延、不同衰减CIR示意。







![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/Channel4.png)







图. CIR的线性叠加可表示任意信号的信道响应。





如上图所示，通过对CIR做不同延时、不同衰减的线性叠加，我们可以表示出任意输入信号s[n]的信道响应输出。

接下来，让我们思考如何在数学上来表示信道冲击响应（CIR）。

通过前面的介绍，我们知道一个单位脉冲信号通过信道后得到的响应是多个不同延时、不同衰减、不同相位的脉冲信号副本的叠加。我们用h[n]代表单位冲击响应通过信道后的结果，h[n]中的每一个值表示单位脉冲经过对应延时后的衰减和相位变化，例如h[1]=0.9ejφ表示单位脉冲通过信道后在时刻1产生一个幅度为0.9、相位变化为φ的信号副本。

假设脉冲通过一个信道产生的最大延时为M，即在0时刻发送的信号，通过信道中最长的传播路径后，可以在时刻M到达接收端，这个最大时延又被称为 **信道时延拓展** 。因此，接收端在任意时刻收到的信号，实际上是其之前M个时刻内发送信号的叠加，即

r[n]=s[n]×h[0]+s[n−1]×h[1]+⋯+s[n−M]×h[M]

上面这个式子可以写成卷积的形式：

r[n]=∑k=0Ms[n−k]h[k]=s⊗h

即，如果已知信道的单位脉冲响应h和任意输入信号s，输出信号可以直接表示为脉冲响应和输入信号的卷积。

> 思考：为什么是卷积运算？

实际上，卷积运算也表明了信道的一个特点，即任意时刻在接收端收到的信号，受其之前若干时刻发送信号的影响。用知乎上的一个例子来类比，别人打你一拳是脉冲输入，但你的身体会疼几个小时，不是瞬间疼痛，给你多几拳，即多个脉冲，你的疼痛感再连续叠加，很直观地说明了信道对信号传输的影响。

> **举例1** - 给定一个信道，直接路径和两条反射路径衰减为0.9，0.5和0.8，延迟分别为15μs和40μs，相位偏移分别为35rad和70rad，则信道冲击响应矩阵h可以表示为？ - 在此信道中发送一个正弦信号x(t)=sin(t)，则接收到端收到的信号可以表示为？若发送一个任意信号s(t)，接收端收到的信号可以表示为？ - 如果存在噪声N(t)，对收到的信号会产生怎样的影响？

在数据传输中，实际上重要的一个过程就是通过接收到的y和测量的h，计算传输的x。这其中带来了另外一个重要的问题就是如何来测量信道冲击响应h。

理想情况下，我们可以在发送端发送一个单位冲击信号，然后在接收端接收该信号对应的响应作为信道冲击响应h。但实际上，发送一个理想的冲击信号是很困难的，因此在实际操作中，我们一般通过发送其他的已知信号来测量信道冲击相应，比如在无线通信技术中常用的preamble或pilot signal，就可以利用来计算信道冲击响应。

## 信道频率响应（CFR）

信号的多径传播在时域上表现为时延扩展，信道的冲击响应通常就代表了这一信息。信道的这些影响在频域上带来的影响是选择性衰。直观上看这是由于信道中有不同延时的路径，通过不同路径的信号在接收端叠加增强或相消，使不同的频率的信号发生不同的衰减。例如当两路多径信号到达接收端的时间差恰好为某频率的半周期，则对应频率的信号在接收端发生明显衰减；如果正好是整数倍的周期，则对应频率的信号是叠加增强的。

因此，我们通常也用信道的频率响应（Channel Frequency Response，CFR）从幅频特性和相频特性来分别描述信道对信号传播的影响。在带宽无限的条件下，CFR与CIR互为时域和频域的等效参数，也就是通过傅里叶变换和逆变换能够转化这两个结果，下图展示了具有频率选择性衰落特征信道的频率响应。



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/channel-response-freq.png)







图. 信道频域响应示意：图中箭头代表了单位信号经过信道后不同频率的影响。





在实际通信系统中，我们通常将时域上的信道冲击响应变换到频域，通过比较输入信号和输出信号的频域特征，我们就可以计算出相应频域上的冲击响应，进而计算出相应信道的时域参数。实际上，频域的信道响应和和时域响应是等价的，只不过一个是时间域上的表示，一个是频率域上的表示，两者可以互相转化。频域的信道响应也是目前研究里面大量物联网定位和感知工作的重要信息来源，借助特定信号的信道频率响应，我们可以计算不同多径路径的传播特征，从中分析出对定位和感知有用的信息。

## 信道状态信息（CSI）

理解了CIR和CFR，就比较好理解信道状态信息（CSI）了。信道状态信息(Channel State Information，CSI)与CFR一样，都从频域描述信道对传输信号的影响，他们的差异在于，CFR作为一般化的参数可以描述任意频率处的信道影响，而CSI通常用于OFDM系统中描述各个子信道的信道属性，即信道增益矩阵H（有时也称为信道矩阵，信道衰落矩阵）中每个元素的值。假设发送端装备M根天线，接收端装备N根天线，通信时使用K个子载波，则每次采样得到CSI矩阵的元素数量为M×N×K，每个元素以复数形式aie−jθi出现，对应每个子载波的幅度和相位。CSI可以使通信系统适应当前的信道条件，在无线通信系统中为高可靠性高速率的通信提供了保障。CSI可以看作CFR的一种离散采样的形式，采样的频率点为OFDM对应的不同载波频率。

CSI可以分为瞬时CSI（Instantaneous CSI）和统计CSI（Statistical CSI）。瞬时CSI意味着当前信道状态已知，因此可以调整发射信号来优化接收信号以达到空间复用或减少比特错误率。统计CSI表示信道的统计特性，如衰落分布的类型、平均信道增益、空间相关性等，这些信息也能用来进行传输优化。在某些快衰落系统中，信道状态在symbol级别都会发生极速的变化，此时应该使用统计CSI。另一方面，在慢衰落系统中，可以在合理精度内得到瞬时CSI估计，在该估计过时前可被用来进行传输适应。

对于CSI的更多介绍，可以参考：ps.zpj.io。

## 信道状态估计

通过前文介绍，我们知道由于无线环境数复杂多变，信号传播到达接收端时，其幅度、相位和频率都会发生很大的改变。因此，为了尽可能恢复出原始信号，我们需要进行信道估计和信道均衡。一个良好的估计和均衡算法对于接收端的性能来说至关重要，决定了信号能否最终被解码出来。

根据是否借助导频信息，信道估计算法可以分为盲估计、半盲估计和非盲信道估计三种。盲信道估计无需借助导频符号，也不占用频谱资源，只利用接收信号本身固有的特征，来获取信道信息。实际上，在具体使用时，因为盲信道估计计算量复杂，收敛较慢，不适合现实的实时交互通信系统。针对盲信道估计的缺陷，半盲信道估计在发射端的调制信号中插入了少量导频。相较于盲信道估计而言，半盲信道估计可以借鉴少量导频信号的频率响应来进行信道估计，因此，其性能要好于盲信道估计。但半盲估计通常假设参考的导频信号不对数据传输造成额外影响，训练序列长度受限，因此可能出现相位模糊（基于子空间的方法）、误差传播（如判决反馈类方法）、收敛慢或陷入局部极小等问题，这在一定程度上限制了它的实用性。非盲估计则是使用一段特殊设计的导频信号来辅助信道估计，基于导频辅助的非盲信道估计算法可以分为两个部分：一是导频位置处的信道估计算法；二是非导频位置处的插值算法。非盲估计是目前通信系统常用的信道估计方式。

**1. LS算法**

下面介绍一种基于最小二乘（LS）算法的非盲信道估计方法。信道估计的本质，是表示出信道的单位脉冲响应CIR。按照前面的定义，最好最直接的办法当然是直接发送一个单位冲击信号，然后接收方看看收到的信号是什么样子。很显然，实际中我们无法这样子去做，因为我们无法发出这样的信号，也就无法利用这样的信号来测量信道。那真实的情况如何做呢，一般的做法为发送已知内容的信号x(t)，看看收到的信号y(t)，理论上y(t)=x(t)∗h(t)。通过这个公式，我们可以算出h(t)的值，从而得到信道参数。在真实的数据包发送中，这个x(t)可以为数据包中的前导码等，前导码一般内容是固定的，所以对于任何接收者来说都是已知的，这样通过分析接收到的信号和发送信号的变化，计算出h。这也是为什么很多材料中说前导码可以起到信道估计的作用。

> 思考：在实际操作中我们如何通过y(t)=x(t)∗h(t)，在原始信号x(t)和接收信号y(t)已知的情况下，如何将信道冲击响应h(t)还原出来？注意这里∗是卷积操作。

由于在时域的卷积操作效果等价于在频域做乘积，因此通过傅里叶变换将信号变换到频域后，假设发送端参考信号为X，Y为接收参考信号，信道表示为H，噪声为N，关系表达式为 $$ Y=XH+N $$ LS算法的基本原理就是使接收信号和无噪声数据之差的平方达到最小： $$

H˜=argmin|Y−XH|2 =argmin[(Y−XH)(Y−XH)T]

$$ 令H˜等于其极限值，即当argmin|Y−XH|2等于0，可以得到： $$ [(Y-XH)(Y-XH)^T] = 0 $$ 对上式中的H求导，得到： $$ (XTX){-1}X^TY = X^{-1}Y = H + N/X $$ 因此，LS算法的信道响应可以表示为： $$ \widetilde{H} = \bigg[\frac{Y(0)}{X(0)}\quad\frac{Y(1)}{X(1)}\quad \cdots\quad \frac{Y(N-1)}{X(N-1)}\bigg]^T $$



由上式可见，LS利用发送端的导频信息，即可以对信道矩阵进行估计，结构简单，计算量小，但它没有考虑接收信号中的噪声、以及子载波间的干扰，所以估计精度有限。在信噪比高的时候，LS算法的效果比较好，当信道噪声较大时，估计性能会大大降低。

下面代码展示了如何使用LS算法估计信道频率响应H：

```
%% Rx_data1为收到信号
%% pilot_seq为原始前导码、

%% 提取前导码信号
Rx_data2 = Rx_data1(N_cp+1:end,:);

%% FFT
Rx_pilot=fft(Rx_data2);
pilot_fft = fft(pilot_seq);

%% 信道估计
h = Rx_pilot./pilot_fft; 
% 分段线性插值：
%    插值点处函数值由连接其最邻近的两侧点的线性函数预测。
%    对超出已知点集的插值点用指定插值方法计算函数值。
H = interp1(1:numel(h), h, 1:0.1:numel(h),'linear','extrap');
```

**2. LMMSE算法**

如果对估计精度的要求高些，LS 可能就达不到了，所以可以采用这种使线性均方误差最小的方式，在平方和的基础上再进行平均。LMMSE算法是在LS算法的基础上发展的，主要目的是为了消除噪声的影响。但LMMSE算法的缺点是计算量大，特别是矩阵的求逆过程是相当的复杂，这在实际应用中较难实现。

使用求导法推导MMSE算法的过程如下：



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/LMMSE.png)



**3. 基于 LS 的 DFT 算法**

这种算法不仅利用快速算法将计算过程大为简化，而且还可以人为的消除部分噪声的干扰。我们知道，信号在通过信道的时候对信道的响应通常只有一小段，而实际上，有很多能量小的点我们都可以把它当作是多余的部分，只考虑集中的几个能量大的点。如果我们有选择性的来选取响应点，将其他点的响应当作0来处理，一定程度上就能补偿原本 LS 算法中噪声的影响。



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S1_%E4%BF%A1%E9%81%93%E5%AE%9A%E4%B9%89/fig/DFT%E7%AE%97%E6%B3%95.png)







图. DFT算法过程





## 参考文献[¶](https://iot-book.github.io/4_无线信道/S1_信道定义/#_4)

1. Zheng Yang, Zimu Zhou, and Yunhao Liu. 2013. From RSSI to CSI: Indoor localization via channel response. *ACM Comput. Surv.* 46, 2, Article 25 (December 2013), 32 pages. DOI: https://doi.org/10.1145/2543581.2543592
2. Xie Y, Li Z, Li M. Precise power delay profiling with commodity Wi-Fi[J]. IEEE Transactions on Mobile Computing, 2018, 18(6): 1342-1355.
3. [Wikipedia/Communication_channel](https://zh.wikipedia.org/wiki/Communication_channel)
4. [Wikipedia/Multipath](https://en.wikipedia.org/wiki/Multipath_propagation)
5. [Wikipedia/Fading](https://zh.wikipedia.org/wiki/Fading)
6. [Wikipedia/Channel_state_information](https://en.wikipedia.org/wiki/Channel_state_information)



# 路径损耗和阴影衰落

本章介绍由路径损耗（path loss）和阴影（shadowing）效应所引起的接收信号随距离变化的规律。路径损耗是由电磁信号在空间中的辐射传播特性造成的，一般认为路径损耗与传播距离直接相关，在相同的传播条件下、信号经过相同的传播距离产生的路径损耗相同。阴影效应是由发射机和接收机之间的障碍物造成的，这些障碍物通过吸收、反射、散射和绕射等方式衰减信号功率，严重时甚至会阻断信号。本章将首先介绍最基础的信号传播模型——自由空间路径损耗模型；然后给出基于大量障碍物的对数正态阴影衰落模型；最后介绍信号质量估计最常用使用的一个指标——信噪比。

## 路径损耗模型

路径损耗，或称传播损耗，指电波在空间传播所产生的损耗，是由发射功率的辐射扩散及信道的传播特性造成的，反映宏观范围内接收信号功率均值的变化。如下图所示，在自由空间中，电磁辐射的强度根据平方反比定律随着距离的增加而减小，因为同样的能量在一个面积上与距离源的距离平方成正比。



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S2_%E8%B7%AF%E5%BE%84%E6%8D%9F%E8%80%97%E4%B8%8E%E9%98%B4%E5%BD%B1%E8%A1%B0%E8%90%BD/fig/1920px-Inverse_square_law.svg.png)







图. 电磁波在空间中传播状态





路径损耗具有以下几方面特点： - 由发射功率的辐射扩散和信道的传播特性造成 - 一般认为对于相同的收发距离，路径损耗相同 - 引起长距离（100m~1000m）上的功率变化

假设信号经过自由空间到达距离d处的接收机，发射机和接收机之间没有任何障碍物，信号沿直线传播。这样的信道称为视距(Line-Of-Sight, LOS)信道，相应的接收信号称为LOS信号。自由空间路径损耗使接收信号相对于发送信号引入了一个复数因子, 产生接收信号：

r(t)=Re{λGl‾‾‾√e−j2πd/λ4πd⋅u(t)ej2πfct}

式中Gl‾‾‾√是在视距方向上发射天线和接收天线的增益之积，e−j2πd/λ是由传播距离d引起相移。

设发射信号s(t)的功率为Pt，由接收信号r(t)的表达式可得到接收功率和发射功率的比为

PrPt=(Gl‾‾‾√λ4πd)2

可见接收功率与收发天线间距离d的平方成反比、与信号波长的平方λ2成正比。因此，载波频率越高、信号波长越短，则接收功率越小。接收功率与波长λ有关是因为接收天线的有效面积和波长有关。

对应的路径损耗可以表示为：

PL dB=10log10PtPr=−10log10Glλ2(4πd)2

自由空间传播时，将接收功率表示为dBm的形式：

PrdBm=PtdBm+10log10(Gl)+20log10(λ)−20log10(4π)−20log10(d)

相应的自由空间路径增(free-space path gain)为：

PG=−PL=10log10Glλ2(4πd)2



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S2_%E8%B7%AF%E5%BE%84%E6%8D%9F%E8%80%97%E4%B8%8E%E9%98%B4%E5%BD%B1%E8%A1%B0%E8%90%BD/fig/Friis.png)







图. 自由空间中电磁波能量随距离衰减曲线





> 思考：有一室内无线局域网，载波频率fc=900MHz, 小区半径10m, 使用全向天线。在自由空间路径损耗模型下，如果要求小区内所有终端的最小接收功率为10μW, 问接入点的发射功率应该是多大？如果工作频率变成5GHz，相应所需的发射功率又为多少？

## 阴影衰落

阴影衰落由发射机和接收机之间的障碍物造成，这些障碍物通过吸收、反射、散射和绕射等方式衰减信号功率，严重时会阻断信号，引起障碍物尺度距离（室外为10m~100m，室内更小）上的功率变化。在移动通信传播环境中，电波在传播路径上遇到起伏的山丘、建筑物、树林等障碍物阻挡，形成电波的阴影区，就会造成信号场强中值的缓慢变化，引起衰落。通常把这种现象称为阴影效应，由此引起的衰落又称为阴影慢衰落。另外，由于气象条件的变化，电波折射系数随时间的平缓变化，使得同一地点接收到的信号场强中值也随时间缓慢地变化。但因为在陆地移动通信中随着时间的慢变化远小于随地形的慢变化，因而常常在工程设计中忽略了随时间的慢变化，而仅考虑随地形的慢变化。它是由于在电波传输路径上受到建筑物或山丘等的阻挡所产生的阴影效应而产生的损耗。它反映了中等范围内数百波长量级接收电平的均值变化而产生的损耗，一般遵从对数正态分布。

阴影衰落造成信号在无线信道传播过程中发生随机变化，传播路径上的反射面和反射体也在随机变化，从而导致给定距距离处接收信号的功率的存在随机性。为了准确地描述信道对信号的影响，我们需要建立一个模型来描述这些因素造成的信号随机衰减。

造成信号随机衰减的因素，一般包括障碍物的位置、障碍物大小、障碍物材料的介电特性、以及反射面和散射体的变化情况。在实际传输场景中，这些因素一般都是未知的，因此只能用统计模型来表征这种随机衰减，最常用的模型是对数正态阴影模型，它已经被实测数据证实，可以用来建模室外和室内无线传播环境中接收功率的变化。

对数正态阴影模型把发射和接收功率的比值ψ=Pt/Pr，假设为一个对数正态分布的随机变量，即

p(ψ)=ξ2π‾‾‾√σψdBψexp[−(10log10ψ−μψdB)22σ2ψdB],ψ>0

其中ξ=10/ln10，μψdB是以dB为单位的ψdB=10log10ψ的均值，σψdB是以dB为单位的ψdB的标准差。上述式子中的均值可以用解析模型或者实测值确定。实测时，由干经验路径损耗的测量已经包括了对阴影衰落的平均，所以μψdB等于路径损耗。对于解析模型，μψdB必须结合考虑障碍物造成的平均衰减和路径损耗（例如从自由空间模型中获得的路径损耗）。也可以把路径损耗从阴影衰落中分离出来单独处理。服从对数正态分布的随机变量称为对数正态随机变量(log-normal random variable）。如果ψ为对数正态分布，那么接收功率和接收信噪比也是对数正态分布的，因为这两个量只是ψ乘上了一个常系数。对数正态分布的接收信噪比的均值和标准差的单位也是dB,而对数正态接收功率有功率量纲，其均值和标准差的单位是dBm或dBW，而不是dB。路径损耗真值ψ的平均值从而可以表示为：

μψ=**E**[ψ]=exp[μψdBξ+σ2ψdB2ξ2]

对数正态分布由两个参数μψdB和σψdB确定， 因为ψ=Pt/Pr总大于1，故μψdB总大于或等于0。

用实测数据确定阴影衰落模型的均值和标准差时，会遇到这样一个问题，就是应该取真值的平均还是取分贝值的平均。方差的计算也存在同样的问题。实际中常常是对测量值的分贝值取平均，来确定平均路径损耗和方差。原因包括以下几点：首先，对数正态模型的数学分析是建立在分贝测量值之上的；其次，有文献表明分贝平均可以使估计误差更小；其三，功率随距离下降的模型一般是对分贝功率测量值和对数距离的关系进行折线近近似。

大量室外信道测量表明，标准差σψdB的范围在4dB~13dB之间，平均值μψdB取决于路径损耗和所在区域内的建筑物属性。μψdB随距离变化，一是由干路径损耗随距离变化，二是因为距离增加时障碍物的数量会增加，造成平均衰减增加。

当阴影衰落主要由阻挡衰减决定时，分贝平均接收功率的高斯模型可以用下面的哀减模型来分析。信号穿过宽度为d的物休时，其衰减近似为

s(d)=e−αdt

式子中α是依赖于障碍物材料和介电性质的衰减常数。若第i个障碍物的衰减常数是αi、障碍物宽度为随机值di，那么信号穿过该区域时的衰减为

s(dt)=e−α∑idi=e−αdt

如果发射机和接收机之间有多个障碍物物， 那么由中心极限定理，dt=∑idi可近似为高斯随机变量，即logs(dt)=αdt是一个均值为μ，方差为σ的高斯随机变量（σ的值由传播环境决定）。

## 信噪比

从前文的介绍中我们能够看出来，如果我们能够完美的测量出信道的影响的话，那么我们在接收端能够完全还原出来发送的信号。但是实际通信过程远没有这么美好，首先完美测量出来信道是很难的（大家可以想一下为什么），同时即便是能够完美测量出来，接收端也还是会收到外界噪声的影响。如何衡量噪声的影响，里面有一个很重要的指标是信噪比（Signal-to-noise ratio，SNR or S/N），用于衡量信号强度与噪声强度的关系，定义为信号功率与噪声功率之比。

SNR=PsignalPnoise=A2signalA2noise

由于信号强度差别通常都会很大，SNR常使用分贝（dB）作为单位。

SNR(dB)=10log10(PsignalPnoise)=20log10(AsignalAnoise)

其中，Psignal为信号功率，Pnoise为噪声功率，Asignal为信号振幅，Anoise为噪声振幅。

很显然，SNR越高，信号越强，我们解码起来就越方便，实验中我们经常需要计算不同SNR下性能，或者产生不同SNR下的数据，MATLAB提供了`awgn`函数用于向目标信号按规定的信噪比加入高斯白噪声，调用示例如下：

```
fs = 100; % sampling frequency
t = 0:1/fs:1;
x = sin(2*pi*4*t);
% Add white Gaussian noise to signal
% snr = 10dB
y = awgn(x, 10, 'measured');
plot(t, [x, y]);
legend('Original Signal', 'Signal with AWGN');
```



![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S2_%E8%B7%AF%E5%BE%84%E6%8D%9F%E8%80%97%E4%B8%8E%E9%98%B4%E5%BD%B1%E8%A1%B0%E8%90%BD/fig/cpt_snr.png)







图. MATLAB AWGN函数效果示意





> 思考：你知道mean(abs(wgn(1e6, 1, 5, 50, 'dBm', 'complex')))的数学期望是什么吗？ 答案：π2⋅100.1⋅(5−30)⋅50⋅12‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾‾√ （你可能需要了解所涉及的matlab函数的功能以及瑞利分布）
>
> **动手试一试** 生成具有不同信噪比的声波信号，从时域、频域分别观察他们的区别，实际听一下看看不同SNR的声波信号有什么区别。

## 参考文献

1. [Wikipedia/Fading](https://zh.wikipedia.org/wiki/Fading)

2. [Wikipedia/Shadowing](https://zh.wikipedia.org/wiki/Shadowing)

3. Goldsmith, Andrea. Wireless communications. Cambridge university press, 2005.

   

# 多径信道模型

   ## 多径效应

   电磁波在传播过程中当通信环境比较复杂时，在接收端可能会收到多路来自不同路径的信号副本。通常来说，这些信号副本的传播路径可以大致分为视距路径（LOS, Line of Sight）和非视距路径（NLOS, None-Line-of-Sight）两类。如下图所示，由不同传播路径到达的信号副本具有不同的延迟和能量衰减。如果第一个到达的信号和最后一个到达的信号时间之差（多径时延扩展）非常小，相当于所有的信号都是在叠加相长（波峰和波峰叠加，波谷和波谷叠加），则这样的多径叠加对信号的解码影响不大。但是当时多径延扩展比较大时，信号的叠加就有可能是相消的（即波峰和和波谷叠加），这样就会造成信号的失真，使接收机无法解码信号。

   

   ![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S3_%E5%A4%9A%E5%BE%84%E4%BF%A1%E9%81%93%E6%A8%A1%E5%9E%8B/fig/cpt_multipath.jpg)

   

   

   

   图. 多径效应示意

   

   

   由多径效应带来的信号的衰落在时间尺度上是和信号的周期同一个数量级，在距离尺度上和信号波长为同一数量级，信号的波长尺度相对于人移动的距离来说是很小的，所以多径效应是快衰落，也叫小尺度衰落；与之对应的，阴影效应和路径损耗是慢衰落，也叫大尺度衰落。

   下面介绍多径效应的数学表达形式，假设要发送的基带信号为u(t)，通过将发送信号与高频载波相乘，并取结果的实部，即为发送端最终发送的信号。乘载波的过程可以表示为：

   s(t)=ℜ{u(t)ej2πfct}=ℜ{(ℜ{u(t)}−jℑ{u(t)})×(cos(2πfct)−jsin(2πfct)}=ℜ{u(t)}cos(2πfct)+ℑ{u(t)}sin(2πfct)

   该信号的多个副本经过不同传播路径后在接收端叠加，叠加后信号可以表示为：

   r(t)=Re{∑n=0N(t)αn(t)u(t−τn(t))ej(2πfc(t−τn(t))+ϕDn(t))}

   从上面这个表示可以看出来，an(t)是不同路径信号幅度时变衰减，由路径损耗和阴影衰落确定；τn(t)是不同路径的信号路径传输时延τn(t)=rn(t)/c，ϕDn(t)是不同路径的多谱勒相移。从上式可以看出，相比于原始信号，第i路多径信号的相位变化量为

   ϕn(t)=2πfcτn(t)−ϕDn(t)

   将ϕn(t)代入r(t)的表达式，有

   r(t)=Re{[∑n=0N(t)αn(t)e−jϕn(t)u(t−τn(t))]ej2πfct}

   上式可以转换成输入信号和信道响应相互卷积的形式：

   r(t)=Re{[∑n=0N(t)αn(t)e−jϕn(t)u(t−τn(t))]ej2πfct}=Re{[∑n=0N(t)αn(t)e−jϕn(t)(∫∞−∞δ(τ−τn(t))u(t−τ)dτ)]ej2πfct}=Re{[∫∞−∞∑n=0N(t)αn(t)e−jϕn(t)δ(τ−τn(t))u(t−τ)dτ]ej2πfct}=Re{[∫∞−∞c(τ,t)u(t−τ)dτ]ej2πfc(t)}

   直观地来理解一下上面的卷积形式的接收信号：对于任意的发射时刻(t−τ)都有可能对t时刻的接收信号产生贡献。但是究竟是哪几个时刻发射信号会产生贡献和产生什么样的贡献呢？c(τ,t)回答了这个问题，通过与c(τ,t)卷积，确定了发射时刻和接受时刻的时间差等于路径传输时延的信号，并赋予了幅度衰减和相位变化。c(τ,t)表示t−τ时刻发出的信号，在时刻t收到，此时信号对应的信道系数。c(τ,t)体现了时变信道的两个特点： 1. 通信时间不同（t不同），对应信道状态不同 2. 传播延时不同（τ不同），对应信道状态不同

   在最简化的情况下，信道响应c(τ,t)不随时间发生变化，这样一来信道响应就只与多径时延有关，即

   c(τ)=∑n=0Nαne−jϕnδ(τ−τn)

   ## 多径衰落模型

   在介绍多径衰落模型之前，我们先回顾一下多径时延扩展的定义：维基百科对多径时延扩展的定义是最长多径路径与最短多径路径之间的传播时间差，即上文使用的第一个到达的信号和最后一个到达的信号时间之差。根据多径时延扩展不同，可以将多径衰落模型分为窄带衰落和宽带衰落。我们用一个示意图形象地展示窄带衰落和宽带衰落的差异，下图中，右上角是窄带衰落，右下角是宽带衰落。

   

   ![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S3_%E5%A4%9A%E5%BE%84%E4%BF%A1%E9%81%93%E6%A8%A1%E5%9E%8B/fig/multi-path.png)

   

   

   

   图. 窄带衰落与宽带衰落示意

   

   

   **窄带衰落**：对于时延扩展远远小于发射信号带宽倒数（Tm远小于1B）的信道引起的衰落叫做窄带衰落。简单理解，由于基带的带宽和码元的周期有着千丝万缕的关系（通常码元周期是基带带宽倒数的整数倍），可以认为窄带衰落发生时，信号的时延扩展远远小于一个码元周期。在这种情况下，从不同路径到达的信号可以认为只有相位和振幅的差异，而调制内容包括频率完全相同，即u(t−τi)≈u(t)。对于窄带衰落，接收信号可以表示为：

   r(t)=Re{u(t)ej2πfct(∑n=0N(t)αn(t)e−jϕn(t))}

   上式中，αn和路径损耗和阴影效应有关，是一个随机变量，相位ϕn受多谱勒、时延、初相影响，也可以看作一个随机量。假设多径数量N(t)足够大，则根据大数定理，系数∑N(t)n=0αn(t)e−jϕn(t)可以看作是一个随机过程（前提是直视路径不存在，否则αn随机的假设不成立）。如下图所示，窄带衰落的最终结果，为多径叠加后在时域上服从零均值高斯分布，即与噪声效果类似，当然这里的前提是多径数量足够多或多径系数αn服从瑞利分布。

   

   ![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S3_%E5%A4%9A%E5%BE%84%E4%BF%A1%E9%81%93%E6%A8%A1%E5%9E%8B/fig/narrow.png)

   

   

   

   图. 窄带衰落效果示意

   

   

   > **思考：** single tone是最常见的窄带信号，假设有一单频信号s(t)=ℜ{ej(2πfct+ϕ0)}=cos(2πfct+ϕ0)将在信道中传播，考虑以下问题：信号经信道传播到达接收端，不考虑LoS，其余多径分量的叠加将产生怎样的结果？

   接收端多径叠加信号可表示为：r(t)=ℜ{[∑Nn=0αn(t)e−jϕn(t)]ej2πfct}，由欧拉公式ejϕ=cos(ϕ)+jsin(ϕ)得

   r(t)=ℜ{[∑n=0Nαn(t)[cos(ϕn(t))−jsin(ϕn(t))]]×[cos(2πfct)+jsin(2πfct)]}=rI(t)cos(2πfct)+rQ(t)sin(2πfct)

   这里的Φ与t有关，是考虑了多普勒效应。上式中的rI(t)和rQ(t)分别表示多径叠加系数（指不同多径相位和振幅的叠加）的In Phase和Quadrature Phase成分：

   rI(t)=∑n=1N(t)αn×cos(ϕn(t))

   rQ(t)=∑n=1N(t)αn×sin(ϕn(t))

   当N趋向于无穷大，根据中心极限定理，rI(t)和rQ(t)分别服从零均值高斯分布（实际上N较小时，只要α(t)服从瑞利分布，上述结论仍然成立）。也就是说，多径叠加的结果，在时域上服从零均值高斯分布，即与噪声效果类似，当然这里的前提是多径数量足够多或多径系数α服从瑞利分布。

   **宽带衰落**：当Tm远小于1B这个条件不成立的时候，发射信号会在接收端产生很宽的时延扩展，这样会导致前一时刻的码元的时延扩展侵占后面码元的时间，从而对其他时刻的码元产生干扰，即码间串扰。消除码间串扰的办法有很多，例如OFDM中的循环前缀，感兴趣的读者可以自行了解。

   ## 多径测量

   本节介绍如何测量多径信息，即测量多径信道中不同信号副本的到达时间和能量衰减。由于多径效应的存在，同一信号的不同副本在以不同延迟和衰减在接收端混叠。为了准确地提取混叠信号中各信号副本的信息，直观上看，我们可以令发送端传输一特定格式的信号s(t)，然后在接收端使用s(t)与收到的多径混叠信号r(t)计算相关性。通过设计s(t)的格式，可以使s(t)只在与多径信号副本完全对齐时产生相关性波峰（调频线性波即为满足此要求的一种常用信号）。最后，通过提取s(t)与r(t)的相关性波峰，即可分离并测量各多径信号分量。

   上述多径测量方法奏效的前提，是将收到信号r(t)与原始信号s(t)计算相关性后，可以准确地分离各相关性波峰。理想情况下，如果对s(t)的信号长度不做限制，则当s(t)与r(t)中信号副本完全对齐时可产生一无限窄的相关性波峰，r(t)中任意两个信号副本的相关性波峰互不影响。但实际上，由于s(t)的持续时间并非无限长，通过相关性计算后得到的是具有一定宽度的波峰，由此r(t)中时间接近的信号副本产生的相关性波峰可能互相重叠，甚至无法区分。

   为了解决这一问题，SIGCOMM’16的工作R2F2提出通过测量接收信号中不同多径副本的到达角来区分不同多径信号。如下图所示，信号经过不同传播路径到达接收端通常产生不同的入射角。

   

   ![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S3_%E5%A4%9A%E5%BE%84%E4%BF%A1%E9%81%93%E6%A8%A1%E5%9E%8B/fig/R2-F2.png)

   

   

   

   图. 多径到达角示意

   

   

   R2F2提出使用多天线接收端，通过分析不同天线接收信号的差异，准确提取多径信号分量的到达角。R2F2的优势在于，尽管不同多径信号的到达时间差异非常微小，但他们的到达角可能存在明显差别，由此相比于直接对接收信号计算相关分离多径，R2F2可以更好地提取不同多径信号之间的差异。但R2F2在实现过程中仍然面临许多挑战，其中最核心的挑战在于如何在接收端有限的天线数量下，尽可能精确地分离不同多径信号的到达角。R2F2提出了一种基于最优化波峰拟合的方法，迭代地优化各波峰参数，从而尽可能精确地恢复不同到达角方向上的波峰。

   

   ![img](https://iot-book.github.io/4_%E6%97%A0%E7%BA%BF%E4%BF%A1%E9%81%93/S3_%E5%A4%9A%E5%BE%84%E4%BF%A1%E9%81%93%E6%A8%A1%E5%9E%8B/fig/R2-F2(2).png)

   

   

   

   图. R2F2提取多径到达角过程示意



# MIMO

# OFDM

# Multi-Users

# MU-MIMO/Massive Mimo

   